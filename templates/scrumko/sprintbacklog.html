{% extends 'scrumko/main.html' %}
{% load static %}

{% block body_block %}

	<script type="text/javascript" src="{% static  'javascript/sprintbacklog.js' %}" ></script>
	
	<h1> Sprint backlog </h1>   
		
		{% for sprintstory in allStories %}	
		<div class="story_container">
			
			<div class="story_name_container">
				{{ sprintstory.story.story_name }}
			</div>
			<div class="story_actions_container">
				<div class="story_priority">
					Priority: {{ sprintstory.story.priority }}
				</div>
				<div class="story_business">
					Buisness value: {{ sprintstory.story.bussines_value }}
				</div>
				<div class="story_edit">
					
					{% if note_permission %}
					<a href="javascript: void(0)" class="edit_note" id="#opener1" data-story="{{sprintstory.story.id}}"><img src="/static/images/note.png" alt="yes" height="20" width="20"></a>
					 <p class="est" style="float: left; margin-top: 0;"></p> 
					{% endif %}
					{% if  is_scrum_master or is_owner%}
						<a href="/scrumko/storyedit/{{ sprintstory.story.id }}"><img src="/static/images/edit.png" alt="yes" height="20" width="20"></a> 	
						<a href="/scrumko/storydelete/{{sprintstory.story.id}}" class="target" ><img src="/static/images/delete.png" alt="yes" height="20" width="20"></a> 					
					{% endif %}
					
		
				</div>
				<div class="backlog_poker">
					<a href="/scrumko/taskcreate/{{ sprintstory.story.id }}">Create tasks</a> 	
				</div>
				
				<div class="story_estimation">
					<p style="float: left;  margin-top: 0;">Estimation: &nbsp;</p> <p class="est" style="float: left; margin-top: 0;">{{sprintstory.story.estimate}}</p> 
					
				
				</div>
				
				<br />
				
			  
			</div>
		
			<div class="story_content_container" >		
		
			{{ sprintstory.story.text }}
			</div>
			
			
			<div class="story_acceptance_test_container" >				
				{{ sprintstory.story.test_text }}
			</div>
			{% if note_permission %}
				
				
					{% for notification in allNotifications %}
						{% if notification.story = sprintstory.story %}
						{% if not notification.notification = "" %}						
						<div class="story_content_container">
							<p class="notes">{{notification.notification}}</p> 
						</div>
						{% endif %}
						{% endif %}
					{% endfor %}
				
			{% endif %}
			<div class="story_sprintbacklog_tasks_background">
				<table class=backlogtasktable>
	   	
					<tr >
						<td class="column_tasks">
							Tasks
						</td>
						<td class="column_status">
							Status
						</td>
						<td class="column_member">
							Member
						</td>
						<td class="column_remaining">
							Remaining
						</td>
						<td class="column_actions">
							Actions
						</td>
					</tr>
				
				{% for task in allTasks%}
					{% if task.story == sprintstory.story%}
					<tr>
						<td class="column_tasks">
							{{ task.text }}
						</td>
						<td class="column_status">
							{% if task.status == 0 %}
								
								<a href="?accept=1&task={{task.id}}">Accept task</a>
							{% elif task.status == 1 %}
								{% if request.user.id == task.worker.id %}
									<a href="?release=1&task={{task.id}}">Release task</a>
								{% else %}
								
								Assigned
								{% endif %}
							{% elif task.status == 2 %}
								Completed
							{% endif %}
						</td>
						<td class="column_member">
							{{ task.worker }}
						</td>
						<td class="column_remaining">
							{{ task.duratino }}
						</td>
						<td class="column_actions">
							{% if not is_owner%}
								<a href="/scrumko/taskedit/{{ task.id }}/"><img src="/static/images/edit.png" alt="yes" height="20" width="20"></a> 	
								{% if task.status == 0%}
								<a href="/scrumko/taskdelete/{{ task.id }}/" class="target2" ><img src="/static/images/delete.png" alt="yes" height="20" width="20"></a> 					
								{% endif %}
							{% endif %}
						</td>
					</tr>
					{% endif %}
				{% endfor %}
				
				</table>
			</div>
		</div>
		<br />	
		{% endfor %}
	
		<div id="dialog" title="Change estimate">
		  <form action="/scrumko/change_estimation1/" method="post" id="estimate_change">{% csrf_token %}
			<input type="hidden" id="storyid" name="storyid" />
			<input type="text" id="estimation" name="estimation" style="float: left"/>
			<input type="submit" id="submit" value="Submit" style="float: left"/>
		  
		  </form>
		</div>
		<div id="dialog_note" title="Add notification">
		  <form action="/scrumko/add_notification1/" method="post" id="add_note">{% csrf_token %}
			<input type="hidden" id="storyid1" name="storyid1" />
			<input type="text" id="note" name="note" style="float: left"/>
			<input type="submit" id="submit1" value="Submit" style="float: left"/>
		  
		  </form>
		</div>
	
{% endblock %}
